version: '3'

tasks:
  # ç–é€šç¢ºèªç”¨
  hello:
    cmds:
      - echo "Hello from Docker with mise & Go!"
      - go version
      - node --version
      - task --version

  # Goã®åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆæœ€åˆã®ä¸€å›ã ã‘å®Ÿè¡Œï¼‰
  init:
    cmds:
      - go mod init stock-analyzer || echo "go.mod already exists"
      - go get modernc.org/sqlite
      - mkdir -p data data/raw web scripts

  # Goã®å®Ÿè¡Œ
  run:
    cmds:
      - go run main.go {{.CLI_ARGS}}

  # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åœ§ç¸®
  compress:
    cmds:
      - chmod +x scripts/compress_db.sh
      - ./scripts/compress_db.sh

  # ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®Webã‚µãƒ¼ãƒãƒ¼èµ·å‹•
  serve:
    cmds:
      - go run main.go -mode=serve

  # ãƒ†ã‚¹ãƒˆãƒ‘ãƒ¼ã‚¹å®Ÿè¡Œ
  test-parse:
    cmds:
      - go run main.go -mode=test-parse

  # æ—¥æ¬¡æ›´æ–°ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  daily-update:
    cmds:
      - echo "ğŸš€ Starting daily update simulation..."
      - go run main.go -mode=run -date={{.DATE | default "2025-11-13"}}
      - task: compress
      - echo "âœ… Daily update completed"

  # GitHub Pages ç”¨ã®é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
  build-web:
    cmds:
      - echo "ğŸŒ Building web assets..."
      - task: compress
      - echo "âœ… Web assets ready in web/"

  # ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  clean:
    cmds:
      - rm -f data/stock_data.db data/stock_data.db.gz
      - echo "ğŸ§¹ Cleaned database files"
