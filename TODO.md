# EDINET XBRL Analyzer - TODO リスト

**参考**: [kawasin73さんの記事](https://kawasin73.hatenablog.com/entry/2025/11/20/224346)

**最終更新**: 2026-01-25

---

## 🏗️ アーキテクチャ・インフラ

> **方針**: S3は使わず、GitHub Releases + GitHub Pages でシンプルに構成

### 0. データソース拡張
- [ ] **TDNET対応** ← 現在はEDINETのみ
  - 適時開示情報の取得
  - 決算発表日の特定

### 1. ストレージ構成（GitHub Releases）
- [x] SQLiteファイルをGitHub Releasesにアップロード（daily-update.yml）
- [ ] **Raw XBRL files** をtar.gz化してReleasesに保存（オプション）
- [x] gzip圧縮版DBの配置（daily-update.ymlで実装済み）

### 2. GitHub Actions 拡張
- [x] 最新ReleasesからSQLiteダウンロード
- [x] 更新済みSQLiteをReleasesにアップロード
- [ ] **GitHub Actions Summary** にDB downloadリンク表示
- [ ] 解析ページリンクをSummaryに出力
- [ ] **新規銘柄発見時のIssue作成**（Daily Notification）

### 3. GitHub Pages ページ構成
- [x] `oneil-screen.html` - オニール成長株アナライザー（プレースホルダー）
- [x] `net-net-value.html` - ネットネットバリュー（プレースホルダー）
- [x] `market-top.html` - マーケット天井検出（プレースホルダー）
- [ ] sqlite-wasm または 静的JSON でDB読み込み（実機能）

### 4. Use Cases 対応
- [ ] **Local Development**: GitHub Releases からDB取得
- [ ] **Local Evaluation**: ブラウザからSQLite/JSON読み込み
- [ ] **Quick Evaluation**: GitHub Pages で直接解析
- [ ] **Daily Notification**: GitHub Issue → メール通知

---

## 🔴 高優先度（記事の主要機能を再現するために必須）

### 5. データベース構成の変更（3ファイル構成）
現在: `stock_data.db` 1つ
目標: 3つのDBファイル構成

- [ ] `xbrl.db` - 財務データ用DB
- [ ] `stock_price.db` - 株価データ用DB
- [ ] `rs.db` - リラティブストレングス用DB

### 6. XBRLパース項目の拡張

#### 資産項目（ネットネット計算用）
- [x] `cash_and_deposits` - 現金及び預金（main.go実装済み）
- [ ] `deposits` - 預金
- [ ] `investment_securities` - 投資有価証券
- [ ] `accounts_receivable` - 売掛金
- [ ] `marketable_securities` - 有価証券
- [ ] `notes_receivable` - 受取手形
- [ ] `inventories` - 棚卸資産

#### 負債項目
- [x] `liabilities` - 負債合計（main.go実装済み）
- [x] `current_liabilities` - 流動負債（main.go実装済み）
- [ ] `non_current_liabilities` - 固定負債

#### 利益・資本項目
- [x] `net_income` - 純利益（main.go実装済み）
- [x] `operating_income` - 営業利益（main.go実装済み）
- [x] `net_assets` - 純資産（main.go実装済み）
- [x] `total_assets` - 総資産（main.go実装済み）
- [x] `current_assets` - 流動資産（main.go実装済み）
- [ ] `shareholders_equity` - 株主資本
- [ ] `eps` - 1株当たり利益（四半期・通期）
- [x] `number_of_shares` - 発行済株式数（main.go実装済み）
- [ ] `roe` - 自己資本利益率（計算ロジック未実装）

### 7. 株価データの取得
- [ ] 外部APIから日次株価を取得
- [ ] 株価テーブル（code, date, open, high, low, close, volume）
- [ ] 時価総額の計算
- [ ] 自己資本比率の計算

---

## 📊 オニール成長株アナライザー機能

### 4. パラメータ設定UI（左パネル）

#### 基本設定
- [ ] 基準日: yyyy/mm/dd（日付ピッカー）
- [ ] 利益タイプ選択: 純利益 (Net Income) / 営業利益

#### スクリーニング閾値
- [ ] Q0 EPS%: デフォルト 25
- [ ] Q1 EPS%: デフォルト 25
- [ ] Q0 売上%: デフォルト 25
- [ ] 年間EPS%: デフォルト 25
- [ ] ROE%: デフォルト 17
- [ ] RS: デフォルト 85

#### ランキングウェイト
- [ ] Q0: デフォルト 0.5
- [ ] Q1: デフォルト 0.3
- [ ] 2Y: デフォルト 0.2

### 5. 成長株ランキングテーブル
| カラム | 説明 |
|--------|------|
| コード | 証券コード |
| 企業名 | 会社名 |
| SCORE | 加重スコア |
| Q0 EPS% | 直近四半期EPS成長率 |
| Q1 EPS% | 1四半期前EPS成長率 |
| 2Y CAGR% | 2年間年平均成長率 |
| Y0 EPS% | 今期EPS成長率 |
| ROE% | 自己資本利益率 |
| RS | リラティブストレングス |
| 自己資本率% | 自己資本比率 |
| 時価総額(億) | 時価総額 |

### 6. 銘柄詳細ページ

#### ヘッダー
- [ ] ←ランキングに戻る ナビゲーション
- [ ] 会社名 + 証券コード表示
- [ ] 日足/週足 切り替えボタン

#### 株価チャート
- [ ] ローソク足チャート
- [ ] 出来高バー
- [ ] 移動平均線
- [ ] **決算発表期間の背景色ハイライト**（黄色/オレンジ）

#### 主要指標カード
- [ ] 最新ROE (通期): XX.X%
- [ ] 最新EPS YoY (四半期): XXXX.X%
- [ ] 最新売上 YoY (四半期): XX.X%
- [ ] 最新EPS YoY (通期): XX.X%
- [ ] 3年EPS CAGR: XX.X%
- [ ] RS: XX

### 7. 財務データ詳細ページ（複数チャートグリッド）
- [ ] ROE (通期) 折れ線チャート
- [ ] 四半期 純利益EPS (Log) 折れ線チャート
- [ ] 四半期 純利益EPS YoY 棒グラフ
- [ ] 連期 純利益EPS (Log) 折れ線チャート
- [ ] 連期 純利益EPS YoY 棒グラフ
- [ ] 四半期 売上高 (Log) 折れ線チャート
- [ ] 四半期 売上高 YoY 棒グラフ

---

## 📈 市場天井検出ツール機能

### 8. 基本設定
- [ ] DBファイル選択（Choose File）
- [ ] 指数選択プルダウン（S&P 500, 日経平均, etc.）

### 9. マーカー表示トグル
- [ ] 分配日 (D) ON/OFF スイッチ
- [ ] ストーリング (S) ON/OFF スイッチ

### 10. 分配日 (Distribution) パラメータ
- [ ] 下落率 (以上): スライダー（デフォルト -0.2%）
- [ ] 条件表示: 終値変化率 <= -0.29%

### 11. ストーリング (Stalling) パラメータ
- [ ] 変化率 (下限): スライダー（デフォルト -0.1）
- [ ] 変化率 (上限): スライダー（デフォルト +0.3）
- [ ] 条件表示

### 12. 共通条件: 出来高
- [ ] 平均日数 (Y): スライダー（デフォルト 25日）
- [ ] 増加率 (X): スライダー（デフォルト 5.0%）
- [ ] AND条件チェックボックス

### 13. 注意期間 (背景色) パラメータ
- [ ] 判定日数 (N): スライダー（デフォルト 25日）
- [ ] マーカー個数 合計 (M): スライダー（デフォルト 6個）
- [ ] 分配日 閾値 (M_d): スライダー（デフォルト 4個）

### 14. 市場天井チャート
- [ ] ローソク足チャート
- [ ] 出来高バー
- [ ] **注意期間の黄色背景ハイライト**
- [ ] 分配日マーカー（赤）
- [ ] ストーリングマーカー（緑）
- [ ] 水平ライン（価格レベル）

---

## 💎 ネットネットバリュー機能

### 15. PBR計算式のカスタマイズ
- [ ] 資産項目の選択UI（係数付き）
- [ ] 負債項目の選択UI（係数付き）
- [ ] 項目の追加・削除機能
- [ ] スペシャルPBR計算

### 16. 計算オプション
- [ ] 上位N社を計算（デフォルト: 50）
- [ ] 特定日で計算（日付ピッカー）
- [ ] 証券コードで追加

### 17. タブ切り替え
- [ ] ランキングタブ
- [ ] PBRチャートタブ
- [ ] カスタムチャートタブ

### 18. ランキングテーブル
- [ ] 順位
- [ ] 証券コード
- [ ] 会社名
- [ ] スペシャルPBR（クリックで詳細）
- [ ] PBR
- [ ] 自己資本比率 (%)
- [ ] 時価総額 (億円)

---

## 🟡 中優先度

### 19. チャートライブラリ
- [ ] **lightweight-charts (TradingView)** の導入
- [ ] ローソク足チャート
- [ ] 出来高チャート
- [ ] 折れ線チャート
- [ ] 棒グラフ
- [ ] マーカー表示
- [ ] 背景色ハイライト

### 20. リラティブストレングス (RS) 計算
- [ ] RS値の計算ロジック
- [ ] RS用DBへの保存
- [ ] RS推移チャート

### 21. 新規銘柄発見時の通知
- [ ] 条件を満たす銘柄の検出
- [ ] GitHub Issue自動作成
- [ ] 銘柄詳細情報をIssue本文に

### 22. ローカルDBファイルアップロード
- [ ] Choose File ボタン（3ファイル対応）
- [ ] プログレスバー表示
- [ ] ダウンロード完了!表示

---

## 🟢 低優先度

### 23. sqlite-wasm の対応
- [ ] ブラウザ内でDB読み込み
- [ ] クエリ実行

### 24. S3への永続化（オプション）
- [ ] 生XBRLファイルのS3アップロード
- [ ] SQLiteファイルのS3保存

### 25. UI/UXの向上
- [ ] SPA化（1ファイルHTML）
- [ ] レスポンシブデザイン
- [ ] 値クリックで詳細ポップアップ

---

## ✅ 完了済み

### インフラ・基盤
- [x] Docker環境構築
- [x] EDINET APIからの書類取得
- [x] SQLite保存（拡張スキーマ対応）
- [x] GitHub Actions日次バッチ（daily-update.yml）
- [x] GitHub Pagesデプロイ（deploy-pages.yml）
- [x] gzip圧縮版DBの配置

### XBRLパース
- [x] 売上高（NetSales）
- [x] 営業利益（OperatingIncome）
- [x] 純利益（NetIncome / ProfitLoss）
- [x] 総資産（TotalAssets / Assets）
- [x] 純資産（NetAssets）
- [x] 流動資産（CurrentAssets）
- [x] 負債合計（Liabilities）
- [x] 流動負債（CurrentLiabilities）
- [x] 現金及び預金（CashAndDeposits）
- [x] 発行済株式数（SharesIssued）

### フロントエンド
- [x] 基本ダッシュボード（ダークモードUI）
- [x] 分析ページのプレースホルダー作成（net-net-value.html, oneil-screen.html, market-top.html）
- [x] Go API + 静的JSONのハイブリッド対応
- [x] テーブルに財務項目列追加（営業利益、純利益、総資産、純資産）
- [x] 金額を億円単位で表示
- [x] テーブルソート機能（ヘッダークリックで昇順/降順切り替え）
- [x] サーバー起動時のDBマイグレーション自動実行

---

## 📊 機能比較サマリー

| 機能 | kawasin73さん | 現プロジェクト |
|------|--------------|----------------|
| DB構成 | 3ファイル (xbrl/stock_price/rs) | 1ファイル ❌ |
| XBRLパース | 多数の財務項目 | **主要10項目 ✅** |
| 株価データ | あり | なし ❌ |
| ネットネット計算 | カスタム係数対応 | なし ❌（データは取得済み） |
| オニールスクリーニング | 完全実装 | なし ❌ |
| RS計算 | 専用DB | なし ❌ |
| 市場天井検出 | パラメータ調整可能 | なし ❌ |
| チャート | lightweight-charts | なし ❌ |
| 決算期間ハイライト | あり | なし ❌ |
| 銘柄詳細ページ | 複数チャート | なし ❌ |

---

## 🎯 推奨実装順序（更新版）

~~1. **XBRLパース拡張** → 全ての計算の基礎~~ ✅ 完了

1. **EPS計算ロジック** → 純利益÷発行済株式数で計算可能に
2. **株価データ取得** → RS・時価総額に必須
3. **ネットネット計算UI実装** → 取得済みデータで計算可能
4. **3DB構成に変更** → xbrl.db / stock_price.db / rs.db
5. **lightweight-charts導入** → チャート表示の基盤
6. **オニールランキング実装** → スコア計算・テーブル
7. **銘柄詳細ページ** → チャート・主要指標
8. **市場天井検出** → パラメータUI・チャート
9. **ネットネット計算** → カスタム係数対応
