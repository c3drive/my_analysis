<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚ªãƒ‹ãƒ¼ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚° | æ ªå¼åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <meta name="description" content="ã‚¦ã‚£ãƒªã‚¢ãƒ ãƒ»ã‚ªãƒ‹ãƒ¼ãƒ«ã®CAN-SLIMæ‰‹æ³•ã«åŸºã¥ãæˆé•·æ ªã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã€‚EPSæˆé•·ç‡ã¨å£²ä¸Šæˆé•·ç‡ã§éŠ˜æŸ„ã‚’è©•ä¾¡ã€‚">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 30px;
        }

        header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, #ff6b6b, #ffd93d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #a0a0a0;
            font-size: 1rem;
        }

        .nav {
            display: flex;
            gap: 10px;
            margin: 25px 0 0 0;
            flex-wrap: wrap;
        }

        .nav a {
            color: #00d9ff;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 8px;
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid rgba(0, 217, 255, 0.3);
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .nav a:hover,
        .nav a.active {
            background: rgba(255, 107, 107, 0.2);
            border-color: #ff6b6b;
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.3);
        }

        .nav a.active {
            color: #ff6b6b;
        }

        .info-box {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .info-box h2 {
            color: #ff6b6b;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .info-box p {
            line-height: 1.8;
            color: #b0b0b0;
        }

        .status-bar {
            display: flex;
            gap: 30px;
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .status-item {
            display: flex;
            flex-direction: column;
        }

        .status-label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ff6b6b;
        }

        /* Scoring Criteria */
        .criteria-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .criteria-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .criteria-card h4 {
            color: #ff6b6b;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .criteria-card ul {
            list-style: none;
            font-size: 0.8rem;
            color: #888;
        }

        .criteria-card li {
            padding: 3px 0;
        }

        .criteria-card .points {
            color: #00ff88;
            font-weight: bold;
        }

        /* Table Styles */
        .table-wrapper {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: rgba(255, 107, 107, 0.2);
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.85rem;
            border-bottom: 2px solid rgba(255, 107, 107, 0.3);
        }

        td {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.9rem;
        }

        tr:hover {
            background: rgba(255, 107, 107, 0.05);
        }

        .rank-cell {
            font-weight: bold;
            color: #ffd93d;
            text-align: center;
            width: 50px;
        }

        .rank-1 {
            color: #ffd700;
            font-size: 1.2rem;
        }

        .rank-2 {
            color: #c0c0c0;
        }

        .rank-3 {
            color: #cd7f32;
        }

        .code-cell {
            font-family: 'Courier New', monospace;
            color: #00d9ff;
            font-weight: 600;
        }

        .name-cell {
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .score-cell {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .score-high {
            color: #00ff88;
        }

        .score-medium {
            color: #ffd93d;
        }

        .score-low {
            color: #ff6b6b;
        }

        .number-cell {
            text-align: right;
            font-family: 'Courier New', monospace;
        }

        .value-good {
            color: #00ff88 !important;
        }

        .value-ok {
            color: #ffd93d !important;
        }

        .value-bad {
            color: #ff6b6b !important;
        }

        .no-data {
            color: #555;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #888;
        }

        .loading-spinner {
            font-size: 2rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .empty-state {
            text-align: center;
            padding: 60px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>ğŸš€ ã‚ªãƒ‹ãƒ¼ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°</h1>
            <p class="subtitle">CAN-SLIMæ‰‹æ³•ã«ã‚ˆã‚‹æˆé•·æ ªç™ºæ˜</p>

            <nav class="nav">
                <a href="index.html">ğŸ“Š åŸºæœ¬ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
                <a href="net-net-value.html">ğŸ’ ãƒãƒƒãƒˆãƒãƒƒãƒˆåˆ†æ</a>
                <a href="oneil-screen.html" class="active">ğŸš€ ã‚ªãƒ‹ãƒ¼ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°</a>
                <a href="market-top.html">ğŸ“ˆ ãƒãƒ¼ã‚±ãƒƒãƒˆå¤©äº•æ¤œå‡º</a>
            </nav>
        </header>

        <div class="info-box">
            <h2>ğŸ“– ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°åŸºæº–</h2>
            <p>
                å„éŠ˜æŸ„ã‚’ä»¥ä¸‹ã®åŸºæº–ã§ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã—ã€ç·åˆè©•ä¾¡ã§ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã—ã¦ã„ã¾ã™ã€‚
                é«˜ROEã€ä½PERã€ä½PBRã€é«˜è‡ªå·±è³‡æœ¬æ¯”ç‡ã®éŠ˜æŸ„ãŒä¸Šä½ã«ãƒ©ãƒ³ã‚¯ã‚¤ãƒ³ã—ã¾ã™ã€‚
            </p>
        </div>

        <div class="criteria-grid">
            <div class="criteria-card">
                <h4>ğŸ“ˆ ROEï¼ˆè‡ªå·±è³‡æœ¬åˆ©ç›Šç‡ï¼‰</h4>
                <ul>
                    <li>20%è¶…: <span class="points">+20ç‚¹</span></li>
                    <li>15%è¶…: <span class="points">+15ç‚¹</span></li>
                    <li>10%è¶…: <span class="points">+10ç‚¹</span></li>
                </ul>
            </div>
            <div class="criteria-card">
                <h4>ğŸ’° PERï¼ˆæ ªä¾¡åç›Šç‡ï¼‰</h4>
                <ul>
                    <li>10å€æœªæº€: <span class="points">+15ç‚¹</span></li>
                    <li>15å€æœªæº€: <span class="points">+10ç‚¹</span></li>
                    <li>20å€æœªæº€: <span class="points">+5ç‚¹</span></li>
                </ul>
            </div>
            <div class="criteria-card">
                <h4>ğŸ“Š PBRï¼ˆæ ªä¾¡ç´”è³‡ç”£å€ç‡ï¼‰</h4>
                <ul>
                    <li>1å€æœªæº€: <span class="points">+10ç‚¹</span></li>
                    <li>1.5å€æœªæº€: <span class="points">+5ç‚¹</span></li>
                </ul>
            </div>
            <div class="criteria-card">
                <h4>ğŸ›¡ï¸ è‡ªå·±è³‡æœ¬æ¯”ç‡</h4>
                <ul>
                    <li>50%è¶…: <span class="points">+10ç‚¹</span></li>
                    <li>30%è¶…: <span class="points">+5ç‚¹</span></li>
                </ul>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-item">
                <span class="status-label">ãƒ‡ãƒ¼ã‚¿çŠ¶æ…‹</span>
                <span class="status-value" id="db-status">èª­è¾¼ä¸­...</span>
            </div>
            <div class="status-item">
                <span class="status-label">å¯¾è±¡éŠ˜æŸ„æ•°</span>
                <span class="status-value" id="stock-count">-</span>
            </div>
            <div class="status-item">
                <span class="status-label">æœ€çµ‚æ›´æ–°</span>
                <span class="status-value" id="last-update">-</span>
            </div>
        </div>

        <div class="table-wrapper">
            <table id="ranking-table">
                <thead>
                    <tr>
                        <th>é †ä½</th>
                        <th>ã‚¹ã‚³ã‚¢</th>
                        <th>ã‚³ãƒ¼ãƒ‰</th>
                        <th>ä¼æ¥­å</th>
                        <th>æ ªä¾¡</th>
                        <th>æ™‚ä¾¡ç·é¡(å„„)</th>
                        <th>EPS(å††)</th>
                        <th>ROE(%)</th>
                        <th>PER</th>
                        <th>PBR</th>
                        <th>è‡ªå·±è³‡æœ¬æ¯”ç‡(%)</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <tr>
                        <td colspan="11" class="loading">
                            <div class="loading-spinner">â³</div>
                            <p>ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let stocksData = [];

        async function loadData() {
            try {
                document.getElementById('db-status').textContent = 'å–å¾—ä¸­...';

                // APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const response = await fetch('/api/oneil-ranking');
                if (!response.ok) throw new Error('API error');
                stocksData = await response.json();

                if (stocksData && stocksData.length > 0) {
                    document.getElementById('db-status').textContent = 'èª­è¾¼å®Œäº†';
                    document.getElementById('stock-count').textContent = stocksData.length + 'ç¤¾';

                    // æœ€æ–°æ›´æ–°æ—¥ã‚’å–å¾—
                    const dates = stocksData
                        .filter(s => s.UpdatedAt)
                        .map(s => s.UpdatedAt.substring(0, 10));
                    if (dates.length > 0) {
                        document.getElementById('last-update').textContent = dates[0];
                    }

                    renderTable(stocksData);
                } else {
                    showEmptyState();
                }
            } catch (error) {
                console.error('Load error:', error);
                showEmptyState();
            }
        }

        function showEmptyState() {
            document.getElementById('db-status').textContent = 'ãƒ‡ãƒ¼ã‚¿ãªã—';
            document.getElementById('table-body').innerHTML = `
                <tr>
                    <td colspan="11" class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <p>å¯¾è±¡ã¨ãªã‚‹éŠ˜æŸ„ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                        <p>è²¡å‹™ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚</p>
                    </td>
                </tr>
            `;
        }

        function formatValue(value, decimals = 1) {
            if (value === null || value === undefined) return { text: '-', class: 'no-data' };
            return { text: value.toFixed(decimals), class: '' };
        }

        function formatOku(value) {
            if (!value || value === 0) return { text: '-', class: 'no-data' };
            const oku = value / 100000000;
            return { text: oku.toFixed(1), class: '' };
        }

        function getScoreClass(score) {
            if (score >= 80) return 'score-high';
            if (score >= 60) return 'score-medium';
            return 'score-low';
        }

        function getRankClass(rank) {
            if (rank === 1) return 'rank-1';
            if (rank === 2) return 'rank-2';
            if (rank === 3) return 'rank-3';
            return '';
        }

        function formatROE(value) {
            if (value === null || value === undefined) return { text: '-', class: 'no-data' };
            let colorClass = '';
            if (value > 20) colorClass = 'value-good';
            else if (value > 15) colorClass = 'value-ok';
            return { text: value.toFixed(1), class: colorClass };
        }

        function formatEPS(value) {
            if (value === null || value === undefined) return { text: '-', class: 'no-data' };
            let colorClass = '';
            if (value > 200) colorClass = 'value-good';
            else if (value > 100) colorClass = 'value-ok';
            else if (value < 0) colorClass = 'value-bad';
            return { text: value.toFixed(1), class: colorClass };
        }

        function formatPER(value) {
            if (value === null || value === undefined) return { text: '-', class: 'no-data' };
            let colorClass = '';
            if (value < 10) colorClass = 'value-good';
            else if (value < 15) colorClass = 'value-ok';
            else if (value > 30) colorClass = 'value-bad';
            return { text: value.toFixed(1), class: colorClass };
        }

        function formatPBR(value) {
            if (value === null || value === undefined) return { text: '-', class: 'no-data' };
            let colorClass = '';
            if (value < 1) colorClass = 'value-good';
            else if (value < 1.5) colorClass = 'value-ok';
            else if (value > 3) colorClass = 'value-bad';
            return { text: value.toFixed(2), class: colorClass };
        }

        function formatEquityRatio(value) {
            if (value === null || value === undefined) return { text: '-', class: 'no-data' };
            let colorClass = '';
            if (value > 50) colorClass = 'value-good';
            else if (value > 30) colorClass = 'value-ok';
            else if (value < 20) colorClass = 'value-bad';
            return { text: value.toFixed(1), class: colorClass };
        }

        function renderTable(stocks) {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';

            stocks.forEach((stock, index) => {
                const rank = index + 1;
                const tr = document.createElement('tr');

                const price = stock.LastPrice > 0
                    ? stock.LastPrice.toLocaleString('ja-JP', { maximumFractionDigits: 0 })
                    : '-';
                const marketCap = formatOku(stock.MarketCap);
                const eps = formatEPS(stock.EPS);
                const roe = formatROE(stock.ROE);
                const per = formatPER(stock.PER);
                const pbr = formatPBR(stock.PBR);
                const equityRatio = formatEquityRatio(stock.EquityRatio);

                tr.innerHTML = `
                    <td class="rank-cell ${getRankClass(rank)}">${rank}</td>
                    <td class="score-cell ${getScoreClass(stock.Score)}">${stock.Score.toFixed(0)}</td>
                    <td class="code-cell">${stock.Code}</td>
                    <td class="name-cell" title="${stock.Name}">${stock.Name}</td>
                    <td class="number-cell">${price}</td>
                    <td class="number-cell ${marketCap.class}">${marketCap.text}</td>
                    <td class="number-cell ${eps.class}">${eps.text}</td>
                    <td class="number-cell ${roe.class}">${roe.text}</td>
                    <td class="number-cell ${per.class}">${per.text}</td>
                    <td class="number-cell ${pbr.class}">${pbr.text}</td>
                    <td class="number-cell ${equityRatio.class}">${equityRatio.text}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // åˆæœŸèª­ã¿è¾¼ã¿
        loadData();
    </script>
</body>

</html>